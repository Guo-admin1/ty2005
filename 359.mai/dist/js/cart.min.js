"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var Cart=function(){function t(){_classCallCheck(this,t),this.tab=$(".buy-goods"),this.init(),this.money=$(".sum-money"),this.sum_inte=$(".sum-inte span"),this.sum_money=$(".count em"),this.plus=$(".plus"),this.reduce=$(".reduce"),this.inte=$(".integral"),this.sum=$(".good-total-price"),this.inp=$(".inp"),this.del_btn=$(".operate .del"),console.log(this.del_btn),this.initPrice(),this.addEvent()}return _createClass(t,[{key:"init",value:function(){var t,e=strToObj(window.localStorage.getItem("goods"));for(t in e){var n=e[t];this.tab[0].innerHTML+='\n                <tbody data-goods-id="'.concat(t,'">\n                    <tr>\n                        <td class="good-pic">\n                            <a href="./details.html">\n                                <img src="').concat(n.src,'" alt="">\n                            </a>\n                        </td>\n                        <td class="good-txt">\n                            <a href="./details.html">').concat(n.txt,"</a>\n                        </td>\n                        <td>").concat(n.price,'</td>\n                        <td>\n                            <div class="good-num">\n                                <a href="javaScript:;" class="reduce">-</a>\n                                <input type="text" value="').concat(n.num,'" class="inp">\n                                <a href="javaScript:;" class="plus">+</a>\n                            </div>\n                        </td>\n                        <td>￥0.00</td>\n                        <td class="integral">').concat((n.price.slice(1)*n.num).toFixed(2),'</td>\n                        <td class="good-total-price">￥').concat((n.price.slice(1)*n.num).toFixed(2),'</td>\n                        <td class="operate">\n                            <a href="javascript:;">收藏</a>|<a href="javascript:;" class="del">移除</a> \n                            <div class="del-good">\n                                <i>!</i><em>确定将商品从购物车中移除吗？</em>\n                                <span class="sure">确定</span>\n                                <span class="close">取消</span>\n                                <div></div>\n                            </div>\n                        </td>\n                    </tr>\n                </tbody>\n            ')}}},{key:"initPrice",value:function(){var t,e=strToObj(window.localStorage.getItem("goods")),n=0;for(t in e)n+=e[t].num*e[t].price.slice(1);this.money.text("￥".concat(n.toFixed(2))),this.sum_inte.text(n),this.sum_money.text("￥".concat(n.toFixed(2)))}},{key:"addEvent",value:function(){var s=this;this.plus.each(function(n,t){$(t).click(function(){var t=$(this).prev().val();t<99&&(t++,$(this).prev().val(t));var e=$(this).parents("td").prev().text().slice(1);$(s.inte[n]).text("".concat((e*t).toFixed(2))),$(s.sum[n]).text("￥".concat((e*t).toFixed(2)));e=$(this).parents("tbody").attr("data-goods-id");s.setStorage(e,t)})}),this.reduce.each(function(n,t){$(t).click(function(){var t=$(this).next().val();1<t&&(t--,$(this).next().val(t));var e=$(this).parents("td").prev().text().slice(1);$(s.inte[n]).text("".concat((e*t).toFixed(2))),$(s.sum[n]).text("￥".concat((e*t).toFixed(2)));e=$(this).parents("tbody").attr("data-goods-id");s.setStorage(e,t)})}),this.inp.each(function(n,t){$(t).blur(function(){var t=$(this).val();!/^\d+$/.test(t)&&t<1?$(this).val("1"):99<t&&$(this).val("99");var e=$(this).parents("td").prev().text().slice(1);$(s.inte[n]).text("".concat((e*t).toFixed(2))),$(s.sum[n]).text("￥".concat((e*t).toFixed(2)));e=$(this).parents("tbody").attr("data-goods-id");s.setStorage(e,t)})}),this.del_btn.each(function(t,e){$(e).click(function(){$(this).next().css("display","block");var t=$(this).next().find(".sure"),e=$(this).next().find(".close"),n=$(this).parents("tbody").attr("data-goods-id"),i=$(this).parents("tbody");t.click(function(){var t=window.localStorage,e=strToObj(t.getItem("goods"));delete e[n],t.setItem("goods",JSON.stringify(e)),i.remove(),s.initPrice()}),e.click(function(){$(this).parent().css("display","none")})})})}},{key:"setStorage",value:function(t,e){var n=window.localStorage,i=strToObj(n.getItem("goods"));i[t].num=parseInt(e),n.setItem("goods",JSON.stringify(i));var s,a=0;for(s in i)a+=i[s].num*i[s].price.slice(1);this.money.text("￥".concat(a.toFixed(2))),console.log(this.money.text()),this.sum_inte.text(a),this.sum_money.text("￥".concat(a.toFixed(2)))}}]),t}();function strToObj(t){return t?JSON.parse(t):{}}new Cart;